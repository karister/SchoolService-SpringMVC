<!DOCTYPE html>
<!-- release v5.2.4, copyright 2014 - 2021 Kartik Visweswaran -->
<!--suppress JSUnresolvedLibraryURL -->
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <title>Krajee JQuery Plugins - &copy; Kartik</title>

  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.min.css"
    crossorigin="anonymous">
  <link href="../../static/bootstrap-fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" crossorigin="anonymous">
  <link href="../../static/bootstrap-fileinput/themes/explorer-fas/theme.css" media="all" rel="stylesheet"
    type="text/css" />
  <!-- jQuery (Bootstrap 的所有 JavaScript 插件都依赖 jQuery，所以必须放在前边) -->
  <script src="../../static/dist/js/jquery-3.4.1.min.js" crossorigin="anonymous"></script>
  <!-- 加载 Bootstrap 的所有 JavaScript 插件。你也可以根据需要只加载单个插件。 -->
  <script src="../../static/dist/js/bootstrap.min.js" crossorigin="anonymous"></script>
  <script src="../../static/bootstrap-fileinput/js/plugins/piexif.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/js/plugins/sortable.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/js/fileinput.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/js/locales/fr.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/js/locales/es.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/themes/gly/theme.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/themes/fas/theme.js" type="text/javascript"></script>
  <script src="../../static/bootstrap-fileinput/themes/explorer-fas/theme.js" type="text/javascript"></script>
  <script>$.fn.fileinput.defaults.theme = 'gly';</script>

  <style>
    .headerBox {
      height: 80px;
      border: 1px solid;
      border-radius: 10px;
      background-image: linear-gradient(120deg, #d4fc79 0%, #96e6a1 100%);
    }

    .headerBox p {
      line-height: 80px;
      font-size: 50px;
      font-family: '隶书';
    }

    .formBox {
      height: 500px;
      /*border: 1px solid;*/
      /*border-radius: 10px;*/
      margin-top: 50px;
    }

    .inputBox {
      margin-top: 10px;
      margin-bottom: 10px;
    }

    .propertisBox {
      /* background-image: linear-gradient(to top, #cfd9df 0%, #e2ebf0 100%); */
    }

    .border {
      border: 1px solid rgb(40, 59, 236);
    }

    .imgBox {
      height: 100px;
      width: 100px;
    }

    .btnBox {
      margin-top: 20px;
      margin-bottom: 40px;
      height: 50px;
      border-radius: 10px;
      font-size: 20px;
    }
  </style>

</head>

<body>

  <div class="container box">
    <div class="row">
      <div class="col-md-12 headerBox">
        <p class="text-center">宿&nbsp;&nbsp;舍&nbsp;&nbsp;报&nbsp;&nbsp;修</p>
      </div>
    </div>
    <div class="row ">
      <a href="/admin/tosstudent" class="btn btn-info col-sm-2">返回主页</a>
    </div>
    <div class="row ">
      <div class="col-md-12">
        <form class="formBox " id="repairForm" action="/repair/form" method="post">
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 btn-succes propertisBox">姓名:</span><input type="text" class="col-md-8" id="name">
          </div>
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 propertisBox">学号:</span><input type="text" class="col-md-8" id="stuid" name="stuid">
          </div>
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 propertisBox">院系:</span><input type="text" class="col-md-8" id="faculty">
          </div>
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 propertisBox">班级:</span><input type="text" class="col-md-8" id="class">
          </div>
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 propertisBox">联系电话:</span><input type="text" class="col-md-8" id="phone">
          </div>
          <div class="col-md-4 col-md-offset-4 inputBox ">
            <span class="col-md-4 propertisBox">报修类别:</span><select class="col-md-8" id="category" name="category">
              <option>照明灯具</option>
              <option>水管，水龙头</option>
              <option>电气线路</option>
              <option>桌椅橱柜</option>
              <option>窗户，门</option>
            </select>
          </div>

          <div class="col-md-8 col-md-offset-3 inputBox">
            <span class="col-md-2 propertisBox">报修地点:</span>
            <select class="col-md-2" id="place1" name="place1">
              <option>东区公寓</option>
              <option>西区公寓</option>
              <option>南区公寓</option>
              <option>北区公寓</option>
              <option>中区公寓</option>
            </select>
            <select class="col-md-2" id="place2" name="place2">
              <div th:each="i:${#numbers.sequence(1,10)}">
                <option th:text="${i} + 栋"></option>
              </div>
            </select>
            <select class="col-md-2" id="place3" name="place3">
              <div th:each="i:${#numbers.sequence(1,5)}">
                <option th:text="${i} + 层"></option>
              </div>
            </select>
            <select class="col-md-2" id="place4" name="place4">
              <div th:each="i:${#numbers.sequence(1,30)}">
                <option th:text="${i} + 室"></option>
              </div>
            </select>
          </div>

          <label class="form-group col-md-8 col-md-offset-2">
            <h4>报修详情</h4>
            <textarea class="form-control  " rows="5" id="detail" name="detail"></textarea>
          </label>

          <div class="my-4 col-md-8 col-md-offset-2">
            <h4>添加图片描述</h4>
            <form enctype="multipart/form-data" method="post">
              <div class="file-loading">
                <input id="kv-explorer" type="file" name="file" multiple>
              </div>
            </form>
          </div>

          <button type="button" class="btn btn-primary btn-bgc col-sm-4 col-sm-offset-4 btnBox"
            onclick="formSub()">提交报修</button>

        </form>
      </div>
    </div>
  </div>



</body>

<script>
  //根据用户session自动填写学生信息
  $(document).ready(function () {
    var name = $('#name');
    var stuid = $('#stuid');
    var faculty = $('#faculty');
    var classs = $('#class');
    var phone = $('#phone');

    $.ajax({
      url: "/admin/getsn",
      data: {},
      dataType: "JSON",
      success: function (data) {
        //session存在
        if (data.code === 1) {
          name.val(data.name);
          stuid.val(data.stuid);
          faculty.val(data.faculty);
          classs.val(data.classs);
          phone.val(data.phone);
        }
        else
          alert('session不存在')
      },
      error: function () {
        alert('服务器错误');
      }
    });

  });

  /**
   * 文件上传ajax
   */
  $(document).ready(function () {
    $("#test-upload").fileinput({
      'theme': 'fas',
      'showPreview': false,
      'allowedFileExtensions': ['jpg', 'png', 'gif'],
      'elErrorContainer': '#errorBlock'
    });
    $("#kv-explorer").fileinput({
      'theme': 'explorer-fas',
      'uploadUrl': '/upload',
      overwriteInitial: false,
    });
  });

  function formSub() {
    var category = $('#category option:selected').val();
    var place1 = $('#place1 option:selected').val();
    var place2 = $('#place2 option:selected').val();
    var place3 = $('#place3 option:selected').val();
    var place4 = $('#place4 option:selected').val();
    var stuid = $('#stuid').val();
    var detail = $('#detail').val();
    if (detail != '') {
      $.ajax({
        url: "/repair/form",
        data: { "stuid": stuid, "category": category, "detail": detail, "place": place1 + place2 + place3 + place4 },
        success: function (data) {
          alert('提交成功');
          window.location.href = "/admin/tosstudent";
        },
        error: function () {
          alert('服务器错误');
        }
      });
    }
    else
      alert('请填写报修详情');
  }

</script>

</html>